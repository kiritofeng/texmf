%This is a package modified from Evan Chen's `evan.sty` file, visit
%https://github.com/vEnhance for more information.

% Legal stuff, gotta prove that PD10 is actually useful...

% %%%%%%%%%%%%%%%%%%%%%%
% %%     evan.sty     %%
% %%%%%%%%%%%%%%%%%%%%%%
%
% This file is licensed under the BOOST software license 1.0.
% This basically means you can do whatever you want with it,
% as long as any TeX source versions published
% include my name and this copyright notice.
% The compiled PDF itself is NOT required to have an attribution,
% although of course such attributions are greatly appreciated :D
% Here is the text of the license:
%
% Boost Software License - Version 1.0 - August 17th, 2003
%
% Copyright (c) 2020 Evan Chen [evan at evanchen.cc]
% https://web.evanchen.cc/ || github.com/vEnhance
%
% Permission is hereby granted, free of charge, to any person or organization
% obtaining a copy of the software and accompanying documentation covered by
% this license (the "Software") to use, reproduce, display, distribute,
% execute, and transmit the Software, and to prepare derivative works of the
% Software, and to permit third-parties to whom the Software is furnished to
% do so, all subject to the following:
%
% The copyright notices in the Software and this entire statement, including
% the above license grant, this restriction and the following disclaimer,
% must be included in all copies of the Software, in whole or in part, and
% all derivative works of the Software, unless such copies or derivative
% works are solely in the form of machine-executable object code generated by
% a source language processor.
%
% THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
% IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
% FITNESS FOR A PARTICULAR PURPOSE, TITLE AND NON-INFRINGEMENT. IN NO EVENT
% SHALL THE COPYRIGHT HOLDERS OR ANYONE DISTRIBUTING THE SOFTWARE BE LIABLE
% FOR ANY DAMAGES OR OTHER LIABILITY, WHETHER IN CONTRACT, TORT OR OTHERWISE,
% ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
% DEALINGS IN THE SOFTWARE.

% Begin actual LaTeX
\ProvidesPackage{kirito}
\RequirePackage{amsmath, amssymb, sectsty}
\RequirePackage{kiritomath}
%%fakesection Argument processing
% Default Arguments
% We include "Kirito" in all of these to make sure
% that they don't collide with anything in external packages
\newif\ifkiritofancy\kiritofancytrue
\newif\ifkiritohdr\kiritohdrtrue
\newif\ifkiritohref\kiritohreftrue
\newif\ifkiritosetup\kiritosetuptrue
\newif\ifkiritothm\kiritothmtrue
\newif\ifkiritosecthm\kiritosecthmfalse
\newif\ifkiritoht\kiritohtfalse
\newif\ifkiritopkg\kiritopkgtrue
\newif\ifkiritopdf\kiritopdftrue
\newif\ifkiritotitling\kiritotitlingtrue
\newif\ifkiritoauthor\kiritoauthortrue
\newif\ifkiritochinese\kiritochinesefalse
\newif\ifkiritomdthm\kiritomdthmfalse
\newif\ifkiritodiagrams\kiritodiagramsfalse
\newif\ifkiritohints\kiritohintsfalse
\newif\ifkiritocolorsec\kiritocolorsecfalse
\newif\ifkiritotitlemark\kiritotitlemarktrue
\newif\ifkiritosibthm\kiritosibthmtrue
\newif\ifkiritothmttl\kiritothmttltrue
\newif\ifkiritophysics\kiritophysicsfalse
\newif\ifkiritoindex\kiritoindexfalse

%Receive Arguments
\DeclareOption{chinese}{\kiritohreffalse\kiritochinesetrue} % Chinese support
% allow href to override this one

\DeclareOption{sexy}{\kiritosecthmtrue\kiritomdthmtrue\kiritocolorsectrue} % long docs

\DeclareOption{fancy}{\kiritofancytrue}
\DeclareOption{nofancy}{\kiritofancyfalse}
\DeclareOption{hdr}{\kiritohdrtrue}
\DeclareOption{nohdr}{\kiritohdrfalse}
\DeclareOption{href}{\kiritohreftrue}
\DeclareOption{nohref}{\kiritohreffalse}

\DeclareOption{nosetup}{\kiritosetupfalse}
\DeclareOption{thm}{\kiritothmtrue}
\DeclareOption{nothm}{\kiritothmfalse}
\DeclareOption{secthm}{\kiritosecthmtrue}
\DeclareOption{nosecthm}{\kiritosecthmfalse}

\DeclareOption{ht}{\kiritohttrue}
\DeclareOption{nopdf}{\kiritopdffalse}
\DeclareOption{nopkg}{\kiritopkgfalse}
\DeclareOption{oldtitle}{\kiritotitlingfalse}
\DeclareOption{newtitle}{\kiritotitlingtrue}
\DeclareOption{noauthor}{\kiritoauthorfalse}
\DeclareOption{titlemark}{\kiritotitlemarktrue} % Sets title in ohead, not \rightmark
\DeclareOption{sectionmark}{\kiritotitlemarkfalse} % Uses \rightmark not title in ohead

\DeclareOption{mdthm}{\kiritomdthmtrue}
\DeclareOption{nomdthm}{\kiritomdthmfalse}
\DeclareOption{diagrams}{\kiritodiagramstrue}
\DeclareOption{nodiagrams}{\kiritodiagramsfalse}
\DeclareOption{colorsec}{\kiritocolorsectrue}
\DeclareOption{nocolorsec}{\kiritocolorsecfalse}

\DeclareOption{hints}{\kiritohintstrue}

\DeclareOption{sibthm}{\kiritosibthmtrue}
\DeclareOption{nosibthm}{\kiritosibthmfalse}

\DeclareOption{thmttl}{\kiritothmttltrue}
\DeclareOption{nothmttl}{\kiritothmttlfalse}

\DeclareOption{physics}{\kiritophysicstrue}
\DeclareOption{nophysics}{\kiritophysicsfalse}

\DeclareOption{index}{\kiritoindextrue}
\DeclareOption{noindex}{\kiritoindexfalse}

\ProcessOptions\relax

% if packages not loaded, turn off mdthm
\ifkiritopkg\else\kiritomdthmfalse\fi

%%fakesection Some macros
%Small commands
\newcommand{\mailto}[1]{\href{mailto:#1}{\texttt{#1}}}
\ifkiritoindex
    %% We need to load this before hyperref
    \usepackage{imakeidx, xifthen}
    \makeindex[intoc, options= -s kiritostyle.ist]
    \newcommand*{\vocab}[2][]{%
        \begingroup%
        \providecommand*{\1}{#1}%
        \providecommand*{\2}{#2}%
        \renewcommand*{\1}{#1}%
        \renewcommand*{\2}{#2}%
        \ifthenelse{\isempty{#1}}{%
            \textbf{\color{blue} #2}\index{#2}%
        }{%
            \textbf{\color{blue} #2}\index{#1}%
        }%
        \endgroup}
\else
    \newcommand*{\vocab}[1]{\textbf{\color{blue} #1}}
\fi
\newcommand{\hrulebar}{
  \par\hspace{\fill}\rule{0.95\linewidth}{.7pt}\hspace{\fill}
  \par\nointerlineskip \vspace{\baselineskip}
}

%For use in author command
\newcommand{\plusemail}[1]{\\ \normalfont \texttt{\mailto{#1}}}

%Re-order numbering layers in `enumerate` enviroment
\renewcommand{\labelenumi}{(\alph{enumi})}

%Convenient Environments
\newenvironment{soln}{\begin{proof}[Solution]}{\end{proof}}
\newenvironment{parlist}{\begin{inparaenum}[(i)]}{\end{inparaenum}}
\newenvironment{gobble}{\setbox\z@\vbox\bgroup}{\egroup}

% From Math 55 and Math 145 at Harvard
\newenvironment{subproof}[1][Proof]{%
\begin{proof}[#1] \renewcommand{\qedsymbol}{$\blacksquare$}}%
{\end{proof}}

%%fakesection Theorem setup
\ifkiritothm
    \ifkiritomdthm
        \PassOptionsToPackage{mdthm}{kiritothm}
    \else
        \PassOptionsToPackage{nomdthm}{kiritothm}
    \fi
    \ifkiritosecthm
        \PassOptionsToPackage{secthm}{kiritothm}
    \else
        \PassOptionsToPackage{nosecthm}{kiritothm}
    \fi
    \ifkiritosibthm
        \PassOptionsToPackage{sibthm}{kiritothm}
    \else
        \PassOptionsToPackage{nosibthm}{kiritothm}
    \fi
    \ifkiritothmttl
        \PassOptionsToPackage{thmttl}{kiritothm}
    \else
        \PassOptionsToPackage{nothmttl}{kiritothm}
    \fi
    \RequirePackage{kiritothm}
\fi


%%fakesection Math Symbols
\ifkiritophysics  % too useful to never use, too stupid to always use
    \PassOptionsToPackage{physics}{kiritosymb}
\else
    \PassOptionsToPackage{nophysics}{kiritosymb}
\fi
\RequirePackage{kiritosymb}

%%fakesection BEGIN MAIN SETUP
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\allsectionsfont{\boldmath}

\ifkiritosetup
    %%fakesection Set up author and date
    \ifkiritoauthor
        \title{}
        \author{Roger Fu}
        \date{\today}
    \fi
    %%fakesection Hyperref
    \ifkiritopkg
        \PassOptionsToPackage{usenames,svgnames,dvipsnames,table}{xcolor}
        \usepackage{xcolor}
        \ifkiritohref
            \usepackage[colorlinks=true]{hyperref}
            \hypersetup{urlcolor=RubineRed,linkcolor=RoyalBlue,citecolor=ForestGreen}
        \fi
    \fi


    %%fakesection Fancy section and chapter heads
    \ifkiritocolorsec
        \@ifundefined{KOMAClassName}{}{
            \@ifundefined{chapter}{}{
                \addtokomafont{partprefix}{\rmfamily}
                \renewcommand*{\partformat}{\color{purple}
                    \scalebox{2.5}{\thepart}\enlargethispage{2em}}
                \addtokomafont{chapterprefix}{\raggedleft}
                \RedeclareSectionCommand[beforeskip=0.5em]{chapter}
                \renewcommand*{\chapterformat}{\mbox{%
                    \scalebox{1.5}{\chapappifchapterprefix{\nobreakspace}}%
                    \scalebox{2.718}{\color{purple}\thechapter}\enskip}}
            }
            \renewcommand*{\sectionformat}%
                {\color{purple}\S\thesection\enskip}
            \renewcommand*{\subsectionformat}%
                {\color{purple}\S\thesubsection\enskip}
            \renewcommand*{\subsubsectionformat}%
                {\color{purple}\S\thesubsubsection\enskip}
            \KOMAoptions{numbers=noenddot}
        }
    \fi


    %%fakesection Loads a bunch of useful packages (but allow disabling)
    \ifkiritopkg
        \IfFileExists{von.sty}{\usepackage{von}}{}
        \usepackage{listings}
        \usepackage{mathrsfs}
        \usepackage{textcomp}
        \lstset{basicstyle=\footnotesize\ttfamily,
            numbers=left,
            numbersep=5pt,
            numberstyle=\tiny,
            keywordstyle=\bfseries,
            % title=\lstname,
            showstringspaces=false,
            tabsize=4,
            frame=single,
            keywordstyle=\bfseries\color{blue},
            commentstyle=\color{green!70!black},
            identifierstyle=\color{green!20!black},
            stringstyle=\color{orange},
            breaklines=true,
            breakatwhitespace=true,
            frame=none
        }
        \usepackage[shortlabels]{enumitem}
        \usepackage[obeyFinal,textsize=scriptsize,shadow]{todonotes}
        \usepackage{textcomp}
        % Tiny tiny optimizations:
        \usepackage{mathtools}
        \usepackage{microtype}
    \fi

    %%fakesection \maketitle configuration
    \ifkiritotitling
    %If we have titling...
        \usepackage{titling}
        \@ifundefined{KOMAClassName}{}{
            \newcommand{\thesubtitle}{}
            \@ifundefined{chapter}{
                % No \chapter, so small style
                \renewcommand{\subtitle}[1]{%
                    \renewcommand{\thesubtitle}{#1}
                    \pretitle{\begin{center}\bfseries \sffamily \Large}
                    \posttitle{\\ {\normalsize \thesubtitle} \end{center}\vspace{\posttitledrop}}
                }
            }{
                % \chapter exists, so large style
                \renewcommand{\subtitle}[1]{%
                    \renewcommand{\thesubtitle}{#1}
                    \pretitle{\begin{center}\bfseries \sffamily \Huge}
                    \posttitle{\\ {\Large \thesubtitle} \end{center}\vspace{\posttitledrop}}
                }
            }
        }
        \newlength{\posttitledrop}
        \newlength{\postauthordrop}
        \@ifundefined{chapter}{
            % No \chapter, so small style
            \setlength{\posttitledrop}{-0.7em}
            \setlength{\postauthordrop}{-1.2em}
            \pretitle{\begin{center}\bfseries \sffamily \Large}
            \posttitle{\end{center}\vspace{\posttitledrop}}
            \preauthor{\begin{center} \scshape}
            \postauthor{\end{center}\vspace{\postauthordrop}}
            \predate{\begin{center}\small}
            \postdate{\end{center}}
        }{
            % \chapter exists, so large style
            \setlength{\droptitle}{-8cm}
            \setlength{\posttitledrop}{1em}
            \setlength{\postauthordrop}{0.5em}
            \pretitle{\begin{center}\bfseries \sffamily \Huge}
            \posttitle{\end{center}\vspace{\posttitledrop}}
            \preauthor{\begin{center} \scshape \LARGE}
            \postauthor{\end{center}\vspace{\postauthordrop}}
            \predate{\begin{center} \Large}
            \postdate{\end{center}}
        }
    \fi

    %%fakesection Commutative diagrams support
    \ifkiritodiagrams
        \RequirePackage{tikz-cd}
        \usetikzlibrary{decorations.pathmorphing}
    \fi

    %%fakesection Page Setup
    \ifkiritofancy
        \@ifundefined{KOMAClassName}
        {
            \usepackage{fancyhdr}
            \setlength{\headheight}{0.75in}
            \setlength{\oddsidemargin}{0in}
            \setlength{\evensidemargin}{0in}
            \setlength{\voffset}{-1.0in}
            \setlength{\headsep}{10pt}
            \setlength{\textwidth}{6.5in}
            \setlength{\headwidth}{6.5in}
            \setlength{\textheight}{8.75in}
            \setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}
            \setlength{\footskip}{0.3in}
            \ifkiritotitling
                \addtolength{\posttitledrop}{0.4em}
                \addtolength{\postauthordrop}{0.2em}
            \fi
            \ifkiritohdr
                \renewcommand{\headrulewidth}{0.5pt}
                \renewcommand{\footrulewidth}{0.0pt}
                \pagestyle{fancy}
                \ifkiritotitling \lhead{\theauthor} \else \lhead{Roger Fu} \fi
                \chead{}
                \rhead{\nouppercase{\leftmark}}
                \lfoot{}
                \cfoot{\thepage}
                \rfoot{}
            \fi
        }
        {
            \usepackage[headsepline]{scrlayer-scrpage}
            \renewcommand{\headfont}{}
            \addtolength{\textheight}{3.14cm}
            \setlength{\footskip}{0.5in}
            \setlength{\headsep}{10pt}
            \ifkiritotitling
                \ihead{\footnotesize\textbf{\theauthor} (\thedate)}
                \else
                \ihead{\footnotesize\textbf{Roger Fu} (\thedate)}
            \fi
            \automark{section}
            \chead{}
            \ifkiritotitlemark
                \ohead{\footnotesize\textbf{\thetitle}}
            \else
                \ohead{\footnotesize\textbf{\headmark}}
            \fi
            \cfoot{\pagemark}
        }
    \fi

    %%fakesection Hints
    \ifkiritohints
        \usepackage{answers}
        \Newassociation{hint}{hintitem}{hints}
        \renewcommand{\solutionextension}{out}
        \Opensolutionfile{hints}
        \newcommand{\makehints}{\Closesolutionfile{hints}\input{hints.out}}
    \fi
%%fakesection END MAIN SETUP
\fi
